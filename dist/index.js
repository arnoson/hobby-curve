var R=(t,a)=>{let n=a?t.length:t.length-1;for(let e=0;e<n;e++){let o=t[e],r=t[e+1]??t[0];o.deltaX=r.x-o.x,o.deltaY=r.y-o.y,o.delta=Math.hypot(o.deltaX,o.deltaY)}};var T=(t,a)=>{let[n,e]=a?[0,t.length]:[1,t.length-1];for(let o=n;o<e;o++){let r=t[o],i=r.prev,l=i.deltaY/i.delta,c=i.deltaX/i.delta;r.psi=Math.atan2(r.deltaY*c-r.deltaX*l,r.deltaX*c+r.deltaY*l)}};var z=(t,a)=>{for(let n=0;n<t.length;n++){let e=t[n];e.phi=-e.psi-e.theta}};var v=function(t,a,n){let e=1/a,o=1/n;return Math.min(4,((3-e)*e**2*t+o**3)/(e**3*t+(3-o)*o**2))},C=(t,a,n,e,o)=>Math.min(4,(2+Math.sqrt(2)*(t-n/16)*(n-t/16)*(a-e))/(1.5*o*(2+(Math.sqrt(5)-1)*a+(3-Math.sqrt(5))*e)));var j=function(t,a){let n=[],e=[],o=[],r=t[0],i=t[1],l=t[t.length-1],c=a?t.length+1:t.length;if(a)n[0]=0,o[0]=0,e[0]=1;else{let s=r.next,h=r.rightX,x=Math.abs(s.leftY),b=Math.abs(r.rightY);n[0]=v(h,b,x),o[0]=-(i.psi*n[0]),e[0]=0}for(let s=1;s<c;s++){let h=t[s]??r,x=h.next,b=h.prev,V=s===c-1;if(a||!V){let g=1/(3*Math.abs(b.rightY)-1),p=h.delta*(3-1/Math.abs(b.rightY)),K=1/(3*Math.abs(x.leftY)-1),d=b.delta*(3-1/Math.abs(x.leftY)),L=1-n[s-1]*g;p=p*L;let X=Math.abs(h.leftY),M=Math.abs(h.rightY);X<M?p*=(X/M)**2:d*=(M/X)**2;let u=d/(d+p);n[s]=u*K;let y=-(x.psi*n[s]);if(u=(1-u)/L,y=y-h.psi*u,u=u*g,o[s]=y-o[s-1]*u,e[s]=-(e[s-1]*u),a&&V){let m=0,P=1;for(let f=s-1;f>=0;f--){let Y=f===0?c-1:f;m=o[Y]-m*n[Y],P=e[Y]-P*n[Y]}m=m/(1-P),r.theta=m,o[0]=m;for(let f=1;f<c-1;f++)o[f]=o[f]+m*e[f];break}}else{let g=h.leftX,p=Math.abs(h.leftY),K=Math.abs(b.rightY),d=v(g,p,K);l.theta=-(o[c-2]*d/(1-d*n[c-2]));break}}for(let s=c-2;s>=0;s-=1)t[s].theta=o[s]-t[s].next.theta*n[s]};var q=(t,a)=>{let n=1/(3*t.rightY);t.rightX=t.x+t.deltaX*n,t.rightY=t.y+t.deltaY*n,n=1/(3*a.leftY),a.leftX=a.x-t.deltaX*n,a.leftY=a.y-t.deltaY*n},D=(t,a)=>{let n=Math.sin(t.theta),e=Math.cos(t.theta),o=Math.sin(a.phi),r=Math.cos(a.phi),i=a.leftY,l=t.rightY,c=C(n,e,o,r,i),s=C(o,r,n,e,l);t.rightX=t.x+(t.deltaX*e-t.deltaY*n)*c,t.rightY=t.y+(t.deltaY*e+t.deltaX*n)*c,a.leftX=a.x-(t.deltaX*r+t.deltaY*o)*s,a.leftY=a.y-(t.deltaY*r-t.deltaX*o)*s};var H=(t,a,n)=>({x:t,y:a,leftY:n,rightY:n,leftX:n,rightX:n,deltaX:0,deltaY:0,delta:0,theta:0,phi:0,psi:0}),$=(t,a=1,n=!1)=>{let e=t.map(({x:l,y:c})=>H(l,c,a)),o=e[0],r=e[e.length-1];for(let l=0;l<e.length;l++)e[l].next=e[l+1]??o,e[l].prev=e[l-1]??r;if(R(e,n),t.length===2&&!n)return q(o,r),e;T(e,n),j(e,n),z(e,n);let i=n?e.length:e.length-1;for(let l=0;l<i;l++)D(e[l],e[l].next);return e},w=(t,a=1,n=!1)=>{let e=$(t,a,n),o=[],r=n?e.length:e.length-1;for(let i=0;i<r;i++){let l=e[i];o.push({startControl:{x:l.rightX,y:l.rightY},endControl:{x:l.next.leftX,y:l.next.leftY},point:{x:l.next.x,y:l.next.y}})}return o},k=(t,a=1,n=!1)=>{let e=w(t,a,n),o=i=>[i.x,i.y].join(","),r=e.map(({startControl:i,endControl:l,point:c})=>[o(i),o(l),o(c)].join(" "));return`M ${t[0].x},${t[0].y} C ${r}`};export{w as createHobbyBezier,k as createHobbyCurve};
